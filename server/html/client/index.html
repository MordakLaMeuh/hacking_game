<!DOCTYPE html>
<html>
<head>
	<title>Mini Chat-Box</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="hacking_game">
	<meta name="author" content="team_banane">
	<link rel="shortcut icon" href="medias/ours.png">
	<link rel='stylesheet' href='index.css' type='text/css' media='all'>
	<link rel='stylesheet' href='keyboard/keyboard.css' type='text/css' media='all'>

	<script type="text/javascript">
	{
		var IS_MOBILE =
			(navigator.userAgent.match(/Android/i)
			|| navigator.userAgent.match(/webOS/i)
			|| navigator.userAgent.match(/iPhone/i)
			|| navigator.userAgent.match(/iPad/i)
			|| navigator.userAgent.match(/iPod/i)
			|| navigator.userAgent.match(/BlackBerry/i)
			|| navigator.userAgent.match(/Windows Phone/i)) ?
			true : false;

		var linkArray = [];
		var cssFilesArray = ["panels/panels", "panels/social/social",
		"panels/browser/browser", "panels/diary/diary", "panels/mail/mail", "panels/tty/tty", "UI_controler/UI_controler"];

		var mobileSuffix = "";
		if (IS_MOBILE == true)
			mobileSuffix = "_mobile";

		var head = document.getElementsByTagName("head");
		for (var i = 0; i < cssFilesArray.length; i++)
		{
			linkArray.push(document.createElement("link"));
			linkArray[i].href = cssFilesArray[i] + mobileSuffix + ".css";
			linkArray[i].rel = "stylesheet";
			linkArray[i].media = "all";
			linkArray[i].type = "text/css";
			head[0].appendChild(linkArray[i]);
		}
	}
	</script>
	<script defer src="medias/icons/fontawesome/js/all.js"></script> <!--load all styles -->
</head>

<body class="noselect" onload="after_load()" style="opacity: 0">

<div id="tab" class="tab">
	<ul id="tabUl">
		<li id="mail_btn" class="tablinks"><a href="#" ><i class="fas fa-envelope"></i></a></li>
		<li id="browser_btn" class="tablinks"><a href="#" ><i class="fas fa-globe"></i></a></li>
		<li id="social_btn" class="tablinks"><a href="#" ><i class="fas fa-address-book"></i></a></li>
		<li id="diary_btn" class="tablinks"><a href="#" ><i class="fas fa-book"></i></a></li>
		<li id="tty_btn" class="tablinks"><a href="#" ><i class="fas fa-terminal"></i></a></li>
	</ul>
</div>

<div id="panels">

	<div id="mail" class="tabcontent">
		<div id="mail-window-bar">
			<i></i><i></i><i></i>
		</div>
		<div id="mail_header">
				<input autocomplete="off" id="backBtn" type="submit" value="Back"/>
				<p id="mailName"></p>
				<input autocomplete="off" id="signInBtn" type="submit" value="Sign out"/>
		</div>
		<div id="mail_body">
				<ul id="mail_info_bar">
					<li>From</li>
					<li>To</li>
					<li>Subject</li>
				</ul>
				<ul id="mail_messages">
				</ul>
		</div>
		<form id="loginForm">
			<p id="errorForm">Invalid login or password</p>
			<div class="input-container">
				<!-- <i class="material-icons icon">email</i> -->
				<input id= "loginInput" class="input-field" type="text" placeholder="Login" spellcheck="false" autocapitalize="none" autocomplete="off" autocorrect="off">
			</div>
			<div class="input-container">
				<!-- <i class="material-icons icon">lock</i> -->
				<input id="passwordInput" class="input-field" type="text" placeholder="Password" spellcheck="false" autocapitalize="none" autocomplete="off" autocorrect="off">
			</div>
			<button id="loginBtn" class="btn" type="button">Login</button>
		</form>
	</div>

	<div id="browser" class="tabcontent">
		<div class="browser-navigation-bar">
			<i></i><i></i><i></i>
		</div>
		<div class="url-bar">
		<input id="url" type="text" onfocus="this.value=''" spellcheck="false" autocorrect="off" autocapitalize="none" autocomplete="off" name="url" value="enter your URL" />
			<input id="go_btn" type="submit" value="Go" />
		</div>
		<div class="browser-container" id="browser-container">
			<img src="medias/macaron.jpg" id="bwr_img" alt="browser content">
		</div>
	</div>

	<div id="social" class="tabcontent">
		<div class="messenger" id="contacts_list"></div>
	</div>

	<div id="diary" class="tabcontent">
		<div class="futurepanel_header">
			<h1 class="futurepanel_title">My diary</h1>
		</div>
		<div class="futurepanel_body" id="diary_body">
		</div>
	</div>
</div>
<div id="js_tty">

</div>
<div id="keyboard" class="hidden">

</div>

<script src="panels/tty/tty.js"></script>
<script src="panels/social/social.js"></script>
<script src="panels/diary/diary.js"></script>
<script src="panels/browser/browser.js"></script>
<script src="panels/mail/mail.js"></script>
<script src="keyboard/keyboard.js"></script>
<script src="UI_controler/UI_controler.js"></script>


<script>
var mousewheelevt=(/Firefox/i.test(navigator.userAgent)) ? "DOMMouseScroll" : "mousewheel"

/*
 * First we get the viewport height and we multiple it by 1% to get a value for a vh unit
 */
let vh = window.innerHeight * 0.01;
/*
 * Then we set the value in the --vh custom property to the root of the document
 */
document.documentElement.style.setProperty('--vh', `${vh}px`);


var socket;

after_load = function() {
	var keyboard = new KEYBOARD();
	var tty = new TTY(keyboard);
	var UI_controler = new UI_CONTROLER(tty.displayCursor);
	var social = new SOCIAL(UI_controler.notif_button_cb);
	var diary = new DIARY(UI_controler.notif_button_cb);
	var browser = new BROWSER(tty.key_cb, keyboard);
	var mail = new MAIL(tty.key_cb, keyboard);

	window.onresize = UI_controler.resizeButtons();
	UI_controler.resizeButtons();

	document.body.style.opacity = 100;

	socket = new WebSocket('ws://' + window.location.hostname + ':8081');

	socket.onmessage = function (res){
		data = JSON.parse(res.data);
		console.log(data);
		if (data.socialContacts) {
			social.displayContacts(data.socialContacts);
			console.log(data.socialContacts);
		}
		if (data.social) {
			console.log(data.social);
			social.addEntry(data.social);
			if (data.social.s)
				diary.addEntry(data.social.s[0], data.social.s[1]);
			return ;
		}
		if (data.diary)
			diary.addEntry(data.diary[0], data.diary[1]);
		if (data.tty)
			tty.onmessage(data.tty);
		if (data.mail) {
			if (data.mail.s)
				diary.addEntry(data.mail.s[0], data.mail.s[1]);
			else
				mail.login(data.mail);
		}
	}

	socket.onerror = function () {
		tty.write("Aucune reponse du serveur");
	}
}
</script>

</body>
</html>
